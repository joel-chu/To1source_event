!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).NBEventService=e()}(this,function(){"use strict";var t=new WeakMap,e=new WeakMap;var o=function(t){void 0===t&&(t={}),t.logger&&"function"==typeof t.logger&&(this.logger=t.logger),this.result=null,this.normalStore=new Map,this.lazyStore=new Map},r={$done:{configurable:!0},normalStore:{configurable:!0},lazyStore:{configurable:!0}};return o.prototype.logger=function(){},o.prototype.$on=function(t,e,o){var r=this;void 0===o&&(o=null);this.validate(t,e);var n=this.takeFromStore(t);if(!1===n)return this.logger("$on",t+" callback is not in lazy store"),this.addToNormalStore(t,"on",e,o);this.logger("$on",t+" found in lazy store");var i=0;return n.forEach(function(n){var a=n[0],l=n[1];r.run(e,a,o||l),i+=r.addToNormalStore(t,"on",e,o||l)}),i},o.prototype.$once=function(t,e,o){void 0===o&&(o=null),this.validate(t,e);var r=this.takeFromStore(t);this.normalStore;if(!1===r)return this.logger("$once",t+" not in the lazy store"),this.addToNormalStore(t,"once",e,o);this.logger("$once",r);var n=Array.from(r)[0],i=n[0],a=n[1];this.run(e,i,o||a),this.$off(t)},o.prototype.$only=function(t,e,o){var r=this;void 0===o&&(o=null),this.validate(t,e);var n=this.takeFromStore(t),i=this.normalStore;if(!1===n){if(this.logger("$only",t+" not in the lazy store"),!i.has(t))return this.logger("$only",t+" add to store"),this.addToNormalStore(t,"only",e,o);this.logger("$only",t+" already existed no longer allow to add new listener")}else{this.logger("$only",t+" found data in lazy store to execute"),Array.from(n).forEach(function(t){var n=t[0],i=t[1];r.run(e,n,o||i)})}},o.prototype.$trigger=function(t,e,o){void 0===e&&(e=[]),void 0===o&&(o=null),this.validateEvt(t);var r=0,n=this.normalStore;if(this.logger("$trigger",n),n.has(t)){this.logger("$trigger",t,"found");for(var i=Array.from(n.get(t)),a=i.length,l=!1,s=0;s<a;++s){r=s;var h=i[s],u=(h[0],h[1]),f=h[2],c=h[3];this.run(u,e,o||f),"once"===c&&(l=!0)}return l&&n.delete(t),r}return this.addToLazyStore(t,e,o),r},o.prototype.$call=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this.logger("$call"),Reflect.apply(this.$trigger,this,t)},o.prototype.$off=function(t){this.validateEvt(t);var e=[this.lazyStore,this.normalStore],o=!1;return e.forEach(function(e){e.has(t)&&(o=!0,e.delete(t))}),o},o.prototype.$get=function(t,e){void 0===e&&(e=!1),this.validateEvt(t);var o=this.normalStore;return!!o.has(t)&&Array.from(o.get(t)).map(function(t){if(e)return t;t[0];return t[1]})},r.$done.set=function(t){this.logger("set $done",t),this.result=t},r.$done.get=function(){return this.result},o.prototype.validateEvt=function(t){if("string"==typeof t)return!0;throw new Error("event name must be string type!")},o.prototype.validate=function(t,e){if(this.validateEvt(t)&&"function"==typeof e)return!0;throw new Error("callback required to be function type!")},o.prototype.run=function(t,e,o){this.logger("run",t),this.logger("run",e),this.logger("run",o),this.$done=Reflect.apply(t,o,this.toArray(e))},o.prototype.takeFromStore=function(t,e){void 0===e&&(e="lazyStore");var o=this[e];if(this.logger("takeFromStore",e,o),o.has(t)){var r=o.get(t);return this.logger("takeFromStore",r),o.delete(t),r}return!1},o.prototype.addToStore=function(t,e){for(var o,r=[],n=arguments.length-2;n-- >0;)r[n]=arguments[n+2];return t.has(e)?(this.logger("addToStore",e+" existed"),o=t.get(e)):(this.logger("addToStore","create new Set for "+e),o=new Set),r.length>2?this.checkContentExist(r,o)||(this.logger("addToStore","insert new",r),o.add(r)):o.add(r),t.set(e,o),[t,o.size]},o.prototype.checkContentExist=function(t,e){return!!Array.from(e).filter(function(e){return e[0]===t[0]}).length},o.prototype.checkTypeInStore=function(t,e){this.validateEvt(t),this.validateEvt(e);var o=this.$get(t,!0);return!1===o||!o.filter(function(t){var o=t[3];return e!==o}).length},o.prototype.addToNormalStore=function(t,e,o,r){if(void 0===r&&(r=null),this.logger("addToNormalStore",t,e,"add to normal store"),this.checkTypeInStore(t,e)){this.logger(e+" can add to "+t+" store");var n=this.hashFnToKey(o),i=this.addToStore(this.normalStore,t,n,o,r,e),a=i[0],l=i[1];return this.normalStore=a,l}return!1},o.prototype.addToLazyStore=function(t,e,o){void 0===e&&(e=[]),void 0===o&&(o=null);var r=this.addToStore(this.lazyStore,t,this.toArray(e),o),n=r[0],i=r[1];return this.lazyStore=n,i},o.prototype.toArray=function(t){return Array.isArray(t)?t:[t]},r.normalStore.set=function(e){t.set(this,e)},r.normalStore.get=function(){return t.get(this)},r.lazyStore.set=function(t){e.set(this,t)},r.lazyStore.get=function(){return e.get(this)},o.prototype.hashFnToKey=function(t){return t.toString().split("").reduce(function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t},0)+""},Object.defineProperties(o.prototype,r),function(t){function e(e){void 0===e&&(e={}),t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.on=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Reflect.apply(this.$on,this,t)},e.prototype.off=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Reflect.apply(this.$off,this,t)},e.prototype.emit=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Reflect.apply(this.$trigger,this,t)},e.prototype.once=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Reflect.apply(this.$once,this,t)},e.prototype.only=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Reflect.apply(this.$only,this,t)},e.prototype.get=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Reflect.apply(this.$get,this,t)},e}(o)});
//# sourceMappingURL=alias.js.map
