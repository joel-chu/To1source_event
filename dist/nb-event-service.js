!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).NBEventService=e()}(this,function(){"use strict";var t=new WeakMap,e=new WeakMap,r=function(t){void 0===t&&(t={}),t.logger&&"function"==typeof t.logger&&(this.logger=t.logger)},o={$store:{configurable:!0},normalStore:{configurable:!0},lazyStore:{configurable:!0}};return r.prototype.logger=function(){},r.prototype.$on=function(t,e,r){var o=this.prepareListener(t,e),n=o[0],i=o[1];if(!1===this.executeFnInLazyStore(t,e,r,n)){if(!i[t]){var a=[this.saveToNormalStore(n,e,r)];return this.normalStore=this.mergeToStore(i,t,a),this.logger("init store",t,a),!0}if(!this.findInStore(i[t],n))return i[t].push(this.saveToNormalStore(n,e,r)),this.normalStore=i,this.logger("append to store",payload),!0}return!1},r.prototype.$once=function(t,e,r){var o=this.prepareListener(t,e),n=o[0],i=o[1];if(!1===this.executeFnInLazyStore(t,e,r,n)&&!i[t]){var a=this.normalStore,s=[this.saveToNormalStore(n,e,r)];return this.normalStore=this.mergeToStore(a,t,s),!0}return!1},r.prototype.$trigger=function(t,e,r){var o=this,n=this.normalStore;(t=Array.isArray(t)?t:[t]).forEach(function(t){if(!n[t]){o.logger("not registered put this in lazy store",t);var i=o.lazyStore,a=Array.isArray(e)?e:[e];return i[t]?i[t].push(a):i[t]=[a],o.lazyStore=i,!1}n[t].forEach(function(t){var o=Array.isArray(e)?e:[e],n=(t[0],t[1]);Reflect.apply(n.fn,r||n.context,o)})})},r.prototype.$off=function(t){var e=this.normalStore;return!(!e[t]||!Reflect.deleteProperty(e,t))&&(this.normalStore=e,!0)},o.$store.get=function(){return this.normalStore},r.prototype.executeFnInLazyStore=function(t,e,r,o){var n=this.lazyStore;if(n[t]){n[t].forEach(function(t){e.apply(r,t)});var i=this.normalStore,a=[this.saveToNormalStore(o,e,r)];return this.normalStore=this.mergeToStore(i,t,a),Reflect.deleteProperty(n,t)&&(this.lazyStore=n),!0}return!1},r.prototype.mergeToStore=function(t,e,r){return t[e]=r,this.logger("check key value",e,r),t},o.normalStore.set=function(e){t.set(this,e)},o.normalStore.get=function(){return t.get(this)||{}},o.lazyStore.set=function(t){e.set(this,t)},o.lazyStore.get=function(){return e.get(this)||{}},r.prototype.prepareListener=function(t,e,r){if(void 0===r&&(r="store"),"string"!=typeof t)throw new Error("Expect event to be string");var o=this["__"+("store"===r?"normalStore":"lazyStore")+"__"];return[this.hashFnToKey(e),o]},r.prototype.saveToNormalStore=function(t,e,r){return void 0===r&&(r=null),[t,{fn:e,context:r}]},r.prototype.findInStore=function(t,e){return!!t.filter(function(t){return t[0]===e}).length},r.prototype.hashFnToKey=function(t){return t.toString().split("").reduce(function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t},0)},Object.defineProperties(r.prototype,o),r});
//# sourceMappingURL=nb-event-service.js.map
