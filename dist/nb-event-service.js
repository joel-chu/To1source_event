!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).NBEventService=r()}(this,function(){"use strict";var t=new WeakMap,r=new WeakMap;var e=function(t){void 0===t&&(t={}),t.logger&&"function"==typeof t.logger&&(this.logger=t.logger),this.result=null,this.normalStore=new Map,this.lazyStore=new Map},o={$done:{configurable:!0},normalStore:{configurable:!0},lazyStore:{configurable:!0}};return e.prototype.logger=function(){},e.prototype.$on=function(t,r,e){var o=this;void 0===e&&(e=null);this.validate(t,r);var n=this.takeFromStore(t);if(!1===n)return this.logger("$on",t+" callback is not in lazy store"),this.addToNormalStore(t,"on",r,e);this.logger("$on",t+" found in lazy store");var i=0;return n.forEach(function(n){var a=n[0],l=n[1];o.run(r,a,e||l),i+=o.addToNormalStore(t,"on",r,e||l)}),i},e.prototype.$once=function(t,r,e){void 0===e&&(e=null),this.validate(t,r);var o=this.takeFromStore(t);this.normalStore;if(!1===o)return this.logger("$once",t+" not in the lazy store"),this.addToNormalStore(t,"once",r,e);this.logger("$once",o);var n=Array.from(o)[0],i=n[0],a=n[1];this.run(r,i,e||a),this.$off(t)},e.prototype.$only=function(t,r,e){var o=this;void 0===e&&(e=null),this.validate(t,r);var n=this.takeFromStore(t),i=this.normalStore;if(!1===n){if(this.logger("$only",t+" not in the lazy store"),!i.has(t))return this.logger("$only",t+" add to store"),this.addToNormalStore(t,"only",r,e);this.logger("$only",t+" already existed no longer allow to add new listener")}else{this.logger("$only",t+" found data in lazy store to execute"),Array.from(n).forEach(function(t){var n=t[0],i=t[1];o.run(r,n,e||i)})}},e.prototype.$trigger=function(t,r,e){void 0===r&&(r=[]),void 0===e&&(e=null),this.validateEvt(t);var o=0,n=this.normalStore;if(this.logger("$trigger",n),n.has(t)){this.logger("$trigger",t,"found");for(var i=Array.from(n.get(t)),a=i.length,l=!1,s=0;s<a;++s){o=s;var h=i[s],u=(h[0],h[1]),f=h[2],g=h[3];this.run(u,r,e||f),"once"===g&&(l=!0)}return l&&n.delete(t),o}return this.addToLazyStore(t,r,e),o},e.prototype.$call=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return this.logger("$call"),Reflect.apply(this.$trigger,this,t)},e.prototype.$off=function(t){this.validateEvt(t);var r=[this.lazyStore,this.normalStore],e=!1;return r.forEach(function(r){r.has(t)&&(e=!0,r.delete(t))}),e},e.prototype.$get=function(t,r){void 0===r&&(r=!1),this.validateEvt(t);var e=this.normalStore;return!!e.has(t)&&Array.from(e.get(t)).map(function(t){if(r)return t;t[0];return t[1]})},o.$done.set=function(t){this.result=t},o.$done.get=function(){return this.result},e.prototype.validateEvt=function(t){if("string"==typeof t)return!0;throw new Error("event name must be string type!")},e.prototype.validate=function(t,r){if(this.validateEvt(t)&&"function"==typeof r)return!0;throw new Error("callback required to be function type!")},e.prototype.run=function(t,r,e){this.logger("run",t),this.logger("run",r),this.logger("run",e),this.$done=Reflect.apply(t,e,this.toArray(r))},e.prototype.takeFromStore=function(t,r){void 0===r&&(r="lazyStore");var e=this[r];if(this.logger("takeFromStore",r,e),e.has(t)){var o=e.get(t);return this.logger("takeFromStore",o),e.delete(t),o}return!1},e.prototype.addToStore=function(t,r){for(var e,o=[],n=arguments.length-2;n-- >0;)o[n]=arguments[n+2];return t.has(r)?(this.logger("addToStore",r+" existed"),e=t.get(r)):(this.logger("addToStore","create new Set for "+r),e=new Set),o.length>2?this.checkContentExist(o,e)||(this.logger("addToStore","insert new",o),e.add(o)):e.add(o),t.set(r,e),[t,e.size]},e.prototype.checkContentExist=function(t,r){return!!Array.from(r).filter(function(r){return r[0]===t[0]}).length},e.prototype.checkTypeInStore=function(t,r){this.validateEvt(t),this.validateEvt(r);var e=this.$get(t,!0);return!1===e?(this.logger("all false"),!1):(this.logger("checking",r),!!e.filter(function(t){var e=t[3];return r!==e}).length)},e.prototype.addToNormalStore=function(t,r,e,o){void 0===o&&(o=null),this.logger("addToNormalStore",t,r,"add to normal store");var n=this.hashFnToKey(e),i=this.addToStore(this.normalStore,t,n,e,o,r),a=i[0],l=i[1];return this.normalStore=a,l},e.prototype.addToLazyStore=function(t,r,e){void 0===r&&(r=[]),void 0===e&&(e=null);var o=this.addToStore(this.lazyStore,t,this.toArray(r),e),n=o[0],i=o[1];return this.lazyStore=n,i},e.prototype.toArray=function(t){return Array.isArray(t)?t:[t]},o.normalStore.set=function(r){t.set(this,r)},o.normalStore.get=function(){return t.get(this)},o.lazyStore.set=function(t){r.set(this,t)},o.lazyStore.get=function(){return r.get(this)},e.prototype.hashFnToKey=function(t){return t.toString().split("").reduce(function(t,r){return(t=(t<<5)-t+r.charCodeAt(0))&t},0)+""},Object.defineProperties(e.prototype,o),e});
//# sourceMappingURL=nb-event-service.js.map
